<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Room Feature with Video Sync and Chat</title>
    <link rel="stylesheet" href="main.css" />
  </head>
  <body>
    <div id="main-container">
      <button id="createRoom">Create Room</button>
      <button id="joinRoom">Join Room</button>
      <input type="text" id="roomIdInput" placeholder="Room ID" />
      <div id="roomControls" style="display: none">
        <input type="text" id="videoUrlInput" placeholder="Video URL" />
        <button id="embedVideo">Embed Video</button>
      </div>

      <div id="videoContainer"></div>

      <div
        id="chatContainer"
        style="
          margin-top: 20px;
          border: 1px solid #ccc;
          padding: 10px;
          width: 100%;
          max-width: 800px;
        "
      >
        <h3>Chat</h3>
      </div>
      <input
        type="text"
        id="messageInput"
        placeholder="Type a message"
        style="width: 80%"
      />
      <button id="sendMessage">Send</button>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    
const socket = io();
let isUserAction = true;

document.getElementById("createRoom").addEventListener("click", () => {
  socket.emit("createRoom");
});

document.getElementById("joinRoom").addEventListener("click", () => {
  const roomId = document.getElementById("roomIdInput").value;
  socket.emit("joinRoom", roomId);
});

document.getElementById("embedVideo").addEventListener("click", () => {
  const roomId = document.getElementById("roomIdInput").value;
  const videoUrl = document.getElementById("videoUrlInput").value;
  socket.emit("embedVideo", roomId, videoUrl);
});

document.getElementById("sendMessage").addEventListener("click", () => {
  const roomId = document.getElementById("roomIdInput").value;
  const message = document.getElementById("messageInput").value;
  socket.emit("sendMessage", roomId, message);
  document.getElementById("messageInput").value = ""; // Clear the input field
});

socket.on("roomCreated", (roomId) => {
  alert(`Room created with ID: ${roomId}`);
  document.getElementById("roomControls").style.display = "block";
  document.getElementById("roomIdInput").value = roomId;
});

socket.on("roomJoined", (roomId, videoUrl) => {
  alert(`Joined room: ${roomId}`);
  document.getElementById("roomControls").style.display = "block";
  if (videoUrl) {
    displayVideo(videoUrl);
  }
});

socket.on("videoEmbedded", (videoUrl) => {
  displayVideo(videoUrl);
});

socket.on("error", (message) => {
  alert(message);
});

socket.on("playVideo", (currentTime) => {
  const videoElement = document.getElementById("videoElement");
  isUserAction = false;
  videoElement.currentTime = currentTime;
  videoElement.play();
});

socket.on("pauseVideo", (currentTime) => {
  const videoElement = document.getElementById("videoElement");
  isUserAction = false;
  videoElement.currentTime = currentTime;
  videoElement.pause();
});

socket.on("seekVideo", (currentTime) => {
  const videoElement = document.getElementById("videoElement");
  isUserAction = false;
  videoElement.currentTime = currentTime;
});

socket.on("receiveMessage", (data) => {
  const chatContainer = document.getElementById("chatContainer");
  const messageElement = document.createElement("p");
  messageElement.textContent = `User ${data.userId}: ${data.message}`;
  chatContainer.appendChild(messageElement);
});

function displayVideo(videoUrl) {
  const videoContainer = document.getElementById("videoContainer");
  videoContainer.innerHTML = `<video id="videoElement" width="560" height="315" controls>
                                    <source src="${videoUrl}" type="video/mp4">
                                </video>`;

  const videoElement = document.getElementById("videoElement");

  videoElement.addEventListener("play", () => {
    if (isUserAction) {
      const roomId = document.getElementById("roomIdInput").value;
      socket.emit("playVideo", roomId, videoElement.currentTime);
    }
    isUserAction = true;
  });

  videoElement.addEventListener("pause", () => {
    if (isUserAction) {
      const roomId = document.getElementById("roomIdInput").value;
      socket.emit("pauseVideo", roomId, videoElement.currentTime);
    }
    isUserAction = true;
  });

  videoElement.addEventListener("seeking", () => {
    if (isUserAction) {
      const roomId = document.getElementById("roomIdInput").value;
      socket.emit("seekVideo", roomId, videoElement.currentTime);
    }
    isUserAction = true;
  });
}


    </script>
  </body>
</html>
